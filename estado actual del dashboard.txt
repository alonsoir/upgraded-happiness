# secuencia, un comando en cada terminal.
rm *.out
En una terminal
sudo python3 promiscuous_agent.py enhanced_agent_config.json
En otra terminal

(upgraded_happiness_venv) â”Œ<â–¸> ~/g/upgraded-happiness
â””â¤ # Test rÃ¡pido de importaciÃ³n
python3 -c "
from src.protocols.protobuf import network_event_pb2
event = network_event_pb2.NetworkEvent()
event.event_type = 'test'  # Este era el que fallaba
print('âœ… Protobuf funcionando - todos los campos disponibles')
"
/Users/aironman/git/upgraded-happiness/upgraded_happiness_venv/lib/python3.13/site-packages/google/protobuf/runtime_version.py:98: UserWarning: Protobuf gencode version 5.29.3 is exactly one major version older than the runtime version 6.31.1 at network_event.proto. Please update the gencode to avoid compatibility violations in the next runtime release.
  warnings.warn(
âœ… Protobuf funcionando - todos los campos disponibles
(upgraded_happiness_venv) â”Œ<â–¸> ~/g/upgraded-happiness
â””â¤ # Terminal 3 - TrÃ¡fico normal
ping -c 3 google.com

# TrÃ¡fico con GPS
python3 generate_gps_traffic.py
PING google.com (142.250.200.142): 56 data bytes
64 bytes from 142.250.200.142: icmp_seq=0 ttl=116 time=13.563 ms
64 bytes from 142.250.200.142: icmp_seq=1 ttl=116 time=14.347 ms
64 bytes from 142.250.200.142: icmp_seq=2 ttl=116 time=12.244 ms

--- google.com ping statistics ---
3 packets transmitted, 3 packets received, 0.0% packet loss
round-trip min/avg/max/stddev = 12.244/13.385/14.347/0.868 ms
ğŸŒ Generador de TrÃ¡fico GPS para Enhanced Promiscuous Agent
==========================================================
ğŸ¯ Modo rÃ¡faga Ãºnica
ğŸ’¡ Para modo continuo: python3 generate_gps_traffic.py continuous [intervalo]

ğŸ“¡ Generando rÃ¡faga de trÃ¡fico con GPS...
/Users/aironman/git/upgraded-happiness/generate_gps_traffic.py:37: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
  "timestamp": datetime.utcnow().isoformat(),
   ğŸ“¤ MQTT-like UDP enviado: 306 bytes
   ğŸ“¤ Coordenadas simples UDP enviado: 31 bytes
   ğŸ“¤ MQTT-like UDP enviado: 303 bytes
   ğŸ“¤ Coordenadas simples UDP enviado: 32 bytes
   ğŸ“¤ MQTT-like UDP enviado: 303 bytes
   ğŸ“¤ Coordenadas simples UDP enviado: 31 bytes
   ğŸ“¤ MQTT-like UDP enviado: 313 bytes
   ğŸ“¤ Coordenadas simples UDP enviado: 36 bytes
   ğŸ“¤ MQTT-like UDP enviado: 304 bytes
   ğŸ“¤ Coordenadas simples UDP enviado: 31 bytes
âœ… RÃ¡faga completada: 10 mensajes enviados

âœ… RÃ¡faga completada: 10 mensajes con coordenadas GPS

ğŸ“‹ Para probar:
1. Ejecutar el agente promiscuo en una terminal
2. Ejecutar el subscriber en otra terminal
3. Ejecutar este generador para ver detecciÃ³n GPS
(upgraded_happiness_venv) â”Œ<â–¸> ~/g/upgraded-happiness
â””â¤

En otra terminal

python3 generate_gps_traffic.py continuous 15

En otra terminal

python3 generate_gps_traffic.py continuous 10

En otra terminal
python ml_detector_with_persistence.py

En otra terminal

python hybrid_dashboard.py ->PDTE

En otra terminal

(upgraded_happiness_venv) â”Œ<â–¸> ~/g/upgraded-happiness
â””â¤ # Ver quÃ© modelos tienes
ls -la saved_models/

# Ver tamaÃ±os
ls -lh saved_models/
total 1776
drwxr-xr-x   9 aironman staff    288 Jul  6 10:33 .
drwxr-xr-x 150 aironman staff   4800 Jul  6 10:33 ..
-rw-r--r--   1 aironman staff 916936 Jul  6 10:33 isolation_forest_20250706_103339.joblib
-rw-r--r--   1 aironman staff   5415 Jul  6 10:33 kmeans_20250706_103339.joblib
-rw-r--r--   1 aironman staff   1319 Jul  6 10:33 naive_bayes_20250706_103339.joblib
-rw-r--r--   1 aironman staff   1120 Jul  6 10:33 processors_20250706_103339.joblib
-rw-r--r--   1 aironman staff 755209 Jul  6 10:33 random_forest_20250706_103339.joblib
-rw-r--r--   1 aironman staff   1261 Jul  6 10:33 sgd_classifier_20250706_103339.joblib
-rw-r--r--   1 aironman staff 120722 Jul  6 10:33 xgboost_20250706_103339.joblib
total 1.8M
-rw-r--r-- 1 aironman staff 896K Jul  6 10:33 isolation_forest_20250706_103339.joblib
-rw-r--r-- 1 aironman staff 5.3K Jul  6 10:33 kmeans_20250706_103339.joblib
-rw-r--r-- 1 aironman staff 1.3K Jul  6 10:33 naive_bayes_20250706_103339.joblib
-rw-r--r-- 1 aironman staff 1.1K Jul  6 10:33 processors_20250706_103339.joblib
-rw-r--r-- 1 aironman staff 738K Jul  6 10:33 random_forest_20250706_103339.joblib
-rw-r--r-- 1 aironman staff 1.3K Jul  6 10:33 sgd_classifier_20250706_103339.joblib
-rw-r--r-- 1 aironman staff 118K Jul  6 10:33 xgboost_20250706_103339.joblib
(upgraded_happiness_venv) â”Œ<â–¸> ~/g/upgraded-happiness
â””â¤ >....
    X_test = np.random.rand(5, 17)
    features = {'src_port': 80, 'dst_port': 443, 'packet_size': 1500,
                'is_internal_src': 0, 'is_internal_dst': 1, 'hour': 14,
                'has_gps': 1, 'lat_category': 4, 'lon_category': 7,
                'ip_class': 2, 'port_category': 2, 'src_port_category': 1,
                'is_business_hours': 1, 'is_weekend': 0, 'size_category': 3,
                'is_large_packet': 1, 'likely_protocol': 2, 'timestamp': 0}

    threats = detector.predict_threat(features)
    print(f'<0001f9e0> Test de predicciÃ³n: {len(threats)} amenazas detectadas')
else:
    print('âŒ No se pudieron cargar modelos')
"
/Users/aironman/git/upgraded-happiness/upgraded_happiness_venv/lib/python3.13/site-packages/google/protobuf/runtime_version.py:98: UserWarning: Protobuf gencode version 5.29.3 is exactly one major version older than the runtime version 6.31.1 at network_event.proto. Please update the gencode to avoid compatibility violations in the next runtime release.
  warnings.warn(
âœ… Protobuf importado exitosamente
ğŸ§  DETECTOR ML LIGERO (Optimizado para Intel i9)
ğŸ’¾ RAM disponible: 32GB (usando hasta 24GB)
ğŸ”§ CPU cores: 8
ğŸ“Š Batch size: 1000
ğŸ”Œ Conectando a: tcp://localhost:5559
ğŸ“¡ Suscrito a topic: 'network_event'
============================================================
ğŸ“‚ Cargando modelos del timestamp: 103339
âœ… Modelos cargados desde disco
   isolation_forest: âŒ
   random_forest: âŒ
   xgboost: âŒ
   gradient_boost: âŒ
   kmeans: âŒ
   dbscan: âŒ
   sgd_classifier: âŒ
   naive_bayes: âŒ
ğŸ§  Test de predicciÃ³n: 0 amenazas detectadas
(upgraded_happiness_venv) â”Œ<â–¸> ~/g/upgraded-happiness
â””â¤

