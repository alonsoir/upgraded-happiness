{
  "component": {
    "name": "lightweight_ml_detector_v3",
    "version": "3.0.0",
    "mode": "distributed_conservative_v3"
  },
  "node_id": "ml_detector_v3_conservative_001",
  "version": "3.0.0",
  "component_type": "ml_detector_v3",

  "network": {
    "input_socket": {
      "address": "localhost",
      "port": 5560,
      "mode": "connect",
      "socket_type": "PULL",
      "description": "Recibe eventos enriquecidos v3 del geoip_enricher con dual GeoIP"
    },
    "output_socket": {
      "address": "localhost",
      "port": 5570,
      "mode": "bind",
      "socket_type": "PUSH",
      "description": "Env칤a eventos v3 con ML scores al dashboard"
    }
  },

  "zmq": {
    "input_port": 5560,
    "output_port": 5570,

    "_comment_hwm": "HWM reducido para evitar saturaci칩n v3",
    "rcvhwm": 500,
    "sndhwm": 500,

    "_comment_timeouts": "Timeouts compatibles con dashboard conservador v3",
    "recv_timeout_ms": 500,
    "send_timeout_ms": 500,

    "_comment_linger": "Cierre inmediato como dashboard",
    "linger_ms": 0,

    "_comment_buffers": "Buffers compatibles con dashboard v3",
    "recv_buffer_size": 65536,
    "send_buffer_size": 65536,

    "_comment_message_size": "CR칈TICO: L칤mite de mensaje compatible con dashboard v3",
    "max_message_size": 10000,

    "vertical_scaling_optimizations": {
      "io_threads": 1,
      "max_sockets": 32,
      "tcp_keepalive": true,
      "tcp_keepalive_idle": 300,
      "immediate": true,
      "conflate": false
    }
  },

  "backpressure": {
    "enabled": true,
    "_comment_retries": "M치s agresivo para evitar bloqueos v3",
    "max_retries": 2,
    "retry_delays_ms": [1, 5, 10],
    "drop_threshold_percent": 5.0,
    "activation_threshold": 20,
    "queue_full_strategy": "drop_oldest",

    "_comment_conservative": "Configuraci칩n conservadora adicional v3",
    "emergency_drop_enabled": true,
    "emergency_drop_threshold_percent": 60.0,
    "force_flush_interval_ms": 100
  },

  "processing": {
    "_comment_threads": "Configuraci칩n conservadora para local v3",
    "threads": 1,
    "send_threads": 1,

    "_comment_queues": "Colas m치s peque침as para evitar memoria excesiva v3",
    "internal_queue_size": 200,
    "protobuf_queue_size": 100,
    "queue_timeout_seconds": 0.3,

    "_comment_performance": "Modo ultra conservador v3",
    "performance_mode": "ultra_conservative_local_v3",
    "enable_heuristics": true,
    "enable_alerts": true,
    "max_processing_time": 1.0,

    "vertical_scaling": {
      "optimized_for_local": true,
      "memory_buffer_multiplier": 0.3,
      "cpu_intensive_operations": false,
      "leave_cores_for_system": 2,
      "processing_batch_optimization": false
    },

    "queue_overflow_handling": {
      "strategy": "emergency_drop",
      "max_queue_wait_ms": 10,
      "emergency_drop_threshold_percent": 50.0,
      "log_drops": true
    },

    "batch_processing": {
      "enabled": false,
      "batch_size": 1,
      "max_wait_ms": 10
    },

    "_comment_message_validation": "Validaci칩n estricta de mensajes v3",
    "message_validation": {
      "enabled": true,
      "max_protobuf_size": 9500,
      "validate_before_processing": true,
      "drop_oversized_messages": true,
      "log_validation_errors": true,
      "validate_v3_schema": true
    }
  },

  "ml": {
    "enabled": true,
    "_comment_thresholds": "游꿢 Umbrales altos para evitar falsos positivos v3",
    "anomaly_threshold": 0.85,
    "high_risk_threshold": 0.95,
    "confidence_threshold": 0.7,

    "models": {
      "isolation_forest": {
        "enabled": true,
        "contamination": 0.1,
        "_comment": "Reducido para local v3",
        "n_estimators": 15,
        "random_state": 42,
        "n_jobs": 1
      },
      "one_class_svm": {
        "_comment": "Deshabilitado - muy pesado para local v3",
        "enabled": false,
        "nu": 0.1,
        "kernel": "rbf"
      },
      "local_outlier_factor": {
        "_comment": "Deshabilitado - pesado para local v3",
        "enabled": false,
        "n_neighbors": 20,
        "contamination": 0.1
      },
      "dbscan": {
        "_comment": "Deshabilitado - pesado para local v3",
        "enabled": false,
        "eps": 0.5,
        "min_samples": 5
      },
      "kmeans": {
        "enabled": true,
        "_comment": "Configuraci칩n ligera v3",
        "n_clusters": 3,
        "random_state": 42,
        "n_init": 1
      },
      "random_forest": {
        "_comment": "Deshabilitado - muy pesado para local v3",
        "enabled": false,
        "n_estimators": 50,
        "random_state": 42,
        "max_depth": 8,
        "n_jobs": 1
      }
    },

    "training": {
      "_comment_training": "Entrenamiento menos frecuente para conservar recursos v3",
      "min_training_samples": 200,
      "retrain_interval_samples": 300,
      "contamination_rate": 0.1,
      "auto_retrain": true,
      "retrain_interval_minutes": 60,
      "max_training_time_seconds": 30
    },

    "features": [
      "packet_size", "dest_port", "src_port", "protocol_numeric",
      "hour", "minute", "is_weekend", "ip_entropy_src", "ip_entropy_dst",
      "port_frequency_src", "port_frequency_dst", "has_geoip",
      "latitude_abs", "longitude_abs", "distance_from_origin",
      "has_dual_enrichment", "geographic_distance_normalized", "same_country",
      "public_ip_discovered", "geographic_anomaly_v3"
    ],

    "feature_engineering": {
      "_comment_v3": "Features actualizadas para protobuf v3.0.0",
      "total_features": 20,
      "enable_port_analysis": true,
      "enable_temporal_features": true,
      "enable_ip_analysis": true,
      "enable_geoip_features": true,
      "enable_v3_dual_geoip": true,
      "enable_v3_geographic_analysis": true,
      "enable_v3_ip_discovery": true,
      "enable_mismatch_detection": true,
      "auto_retrain_on_mismatch": true,
      "feature_caching_enabled": true,
      "cache_size": 100
    }
  },

  "persistence": {
    "enabled": true,
    "models_dir": "ml_models_v3",
    "save_predictions": false,
    "predictions_file": "data/predictions_v3.jsonl",
    "_comment": "Guardado menos frecuente para local v3",
    "auto_save_interval": 1800,
    "state_file": "data/ml_detector_v3_state.json",
    "backup_models": true,
    "model_versioning": true,
    "evaluation_enabled": false,

    "_comment_conservative": "Configuraci칩n conservadora de persistencia v3",
    "max_model_files": 5,
    "compress_models": true,
    "cleanup_old_models": true,
    "protobuf_version_tracking": true
  },

  "logging": {
    "_comment_dual": "游댠 LOGGING DUAL ACTIVADO: consola + archivo",
    "level": "INFO",
    "format": "%(asctime)s - %(name)s - %(levelname)s - [node_id:{node_id}] [pid:{pid}] [v3] - %(message)s",
    "file": "logs/ml_detector_v3.log",
    "max_file_size_mb": 50,
    "backup_count": 3,
    "performance_logging": {
      "enabled": true,
      "log_slow_requests": true,
      "_comment": "Umbral m치s bajo para detectar problemas v3",
      "slow_request_threshold_ms": 15
    },
    "_comment_dual_setup": "Se configurar치 autom치ticamente logging a consola Y archivo",
    "console_logging": {
      "enabled": true,
      "level": "INFO",
      "format_console": "%(asctime)s [v3] %(levelname)s: %(message)s"
    },
    "file_logging": {
      "enabled": true,
      "level": "INFO",
      "rotation_enabled": true
    }
  },

  "monitoring": {
    "_comment": "Monitoreo m치s frecuente para detectar problemas v3",
    "stats_interval_seconds": 20,
    "detailed_metrics": true,

    "component_health_check": {
      "enabled": true,
      "check_interval_seconds": 30,
      "_comment": "Umbrales m치s bajos para local v3",
      "memory_threshold_mb": 128,
      "cpu_threshold_percent": 40.0
    },

    "alerts": {
      "_comment": "Alertas m치s sensibles para detectar problemas temprano v3",
      "max_queue_usage_percent": 40.0,
      "max_ml_failure_rate_percent": 10.0,
      "max_processing_latency_ms": 25.0,
      "max_backpressure_activations": 5,
      "max_drop_rate_percent": 2.0,
      "min_model_accuracy_percent": 60.0,
      "max_buffer_full_errors": 3,
      "_comment_new": "Nuevas alertas para compatibilidad ZMQ v3",
      "max_message_size_violations": 5,
      "max_send_timeouts": 10,
      "_comment_v3": "Alertas espec칤ficas para protobuf v3",
      "min_v3_dual_enrichment_rate": 50.0,
      "max_v3_feature_extraction_errors": 5
    },

    "metrics_export": {
      "enabled": false,
      "prometheus_port": 9091,
      "export_interval_seconds": 60
    }
  },

  "distributed": {
    "cluster_name": "upgraded-happiness-cluster-v3",
    "component_role": "ml_detector_v3_conservative",
    "enable_container_detection": true,
    "enable_system_info_collection": true,

    "pipeline_tracking": {
      "enabled": true,
      "track_latency": true,
      "track_component_path": true,
      "max_pipeline_hops": 5,
      "_comment": "Tracking simplificado para local v3",
      "lightweight_tracking": true,
      "track_v3_enhancements": true
    },

    "load_balancing": {
      "strategy": "simple",
      "health_check_enabled": true,
      "failover_timeout_ms": 2000
    },

    "scaling": {
      "_comment": "Sin auto-scaling para local v3",
      "auto_scale_enabled": false,
      "min_instances": 1,
      "max_instances": 1,
      "scale_up_threshold_percent": 90.0,
      "scale_down_threshold_percent": 10.0,
      "cooldown_period_seconds": 300
    }
  },

  "security": {
    "input_validation": {
      "enabled": true,
      "_comment": "Validaci칩n m치s estricta v3",
      "max_event_size_bytes": 10000,
      "validate_protobuf_schema": true,
      "validate_v3_schema_version": true,
      "sanitize_ml_scores": true,
      "reject_malformed_events": true,
      "validate_v3_dual_enrichment": true
    },

    "rate_limiting": {
      "enabled": true,
      "_comment": "Rate limiting conservador para local v3",
      "max_events_per_second": 50,
      "burst_capacity": 100,
      "penalty_duration_seconds": 30
    }
  },

  "debug": {
    "enabled": false,
    "sample_events": false,
    "sample_rate_percent": 0.1,
    "log_protobuf_details": false,
    "profile_performance": false,
    "log_ml_predictions": false,
    "log_feature_extraction": false,

    "_comment_conservative": "Debug adicional para compatibilidad ZMQ v3",
    "log_zmq_errors": true,
    "log_backpressure_events": true,
    "log_message_sizes": false,
    "_comment_v3": "Debug espec칤fico para protobuf v3",
    "log_v3_dual_enrichment": false,
    "log_v3_geographic_analysis": false,
    "log_v3_feature_extraction": false,
    "validate_v3_compatibility": true
  },

  "_comment_v3_features": "=== NUEVAS CARACTER칈STICAS v3.0.0 ===",
  "v3_enhancements": {
    "dual_geoip_support": {
      "enabled": true,
      "prefer_dual_enrichment": true,
      "fallback_to_legacy": true,
      "validate_coordinate_pairs": true
    },

    "geographic_analysis": {
      "enabled": true,
      "calculate_distance": true,
      "categorize_distance": true,
      "detect_country_mismatch": true,
      "anomaly_scoring": true
    },

    "ip_discovery_analysis": {
      "enabled": true,
      "track_public_ip_discovery": true,
      "analyze_discovery_patterns": true,
      "flag_suspicious_discovery": true
    },

    "threat_intelligence": {
      "enabled": false,
      "check_tor_exits": false,
      "check_malicious_ips": false,
      "use_external_feeds": false
    },

    "performance_tracking": {
      "enabled": true,
      "track_v3_processing_time": true,
      "monitor_dual_enrichment_success": true,
      "alert_on_v3_failures": true
    }
  },

  "_comment_compatibility": "=== COMPATIBILIDAD Y MIGRACI칍N ===",
  "compatibility": {
    "backward_compatible_with_v2": true,
    "forward_compatible_preparation": true,
    "migration_mode": false,
    "validate_legacy_fields": true,
    "log_compatibility_issues": true
  },

  "_comment_validation": "Todas las configuraciones han sido validadas para protobuf v3.0.0"
}