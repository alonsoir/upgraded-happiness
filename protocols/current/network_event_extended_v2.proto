syntax = "proto3";

// âœ… PACKAGE PARA EVENTOS DE RED DISTRIBUIDOS
package network.events.distributed;

// Comando para generar cÃ³digo Python:
// protoc --python_out=. network_event_extended_v2.proto

message NetworkEvent {
    // ğŸ” IdentificaciÃ³n del evento
    string event_id = 1;
    int64 timestamp = 2;

    // ğŸŒ InformaciÃ³n de red bÃ¡sica
    string source_ip = 3;
    string target_ip = 4;
    int32 packet_size = 5;
    int32 dest_port = 6;
    int32 src_port = 7;
    string protocol = 8;              // "tcp", "udp", "icmp", etc.

    // ğŸ¤– IdentificaciÃ³n del agente (legacy - mantener compatibilidad)
    string agent_id = 9;

    // ğŸ“Š MÃ©tricas y scoring
    float anomaly_score = 10;
    double latitude = 11;
    double longitude = 12;

    // ğŸ¯ ClasificaciÃ³n de eventos
    string event_type = 13;           // "normal", "suspicious", "tor_detected", etc.
    float risk_score = 14;
    string description = 15;

    // ğŸ–¥ï¸ InformaciÃ³n del sistema operativo
    string so_identifier = 16;        // "linux_ufw", "linux_iptables", "windows_firewall", "darwin_pf"

    // ğŸ  InformaciÃ³n del nodo (handshake inicial)
    string node_hostname = 17;        // Hostname del nodo
    string os_version = 18;           // "Ubuntu 22.04", "Windows 11", etc.
    string firewall_status = 19;      // "active", "inactive", "unknown"
    string agent_version = 20;        // VersiÃ³n del agente
    bool is_initial_handshake = 21;   // true solo en el primer evento del nodo

    // ğŸ†” NUEVOS CAMPOS DISTRIBUIDOS - CRÃTICOS PARA ETCD
    string node_id = 22;              // Identificador Ãºnico asignado por etcd
    int32 process_id = 23;            // PID del proceso dentro del contenedor
    string container_id = 24;         // ID del contenedor (Docker/Podman) - opcional
    string cluster_name = 25;         // Nombre del cluster distribuido - opcional

    // ğŸ”„ Estado del componente distribuido
    string component_status = 26;     // "healthy", "degraded", "initializing"
    int64 uptime_seconds = 27;        // Tiempo de vida del componente

    // ğŸ“ˆ MÃ©tricas de performance del nodo
    int32 queue_depth = 28;           // Profundidad de cola interna
    float cpu_usage_percent = 29;     // Uso de CPU del componente
    float memory_usage_mb = 30;       // Uso de memoria en MB

    // ğŸ”§ ConfiguraciÃ³n dinÃ¡mica
    string config_version = 31;       // VersiÃ³n de configuraciÃ³n aplicada
    int64 config_timestamp = 32;      // Timestamp de Ãºltima actualizaciÃ³n de config

    // ğŸŒ Enriquecimiento GeoIP (para compatibilidad)
    bool geoip_enriched = 33;         // Indica si ha pasado por enriquecimiento GeoIP
    string enrichment_node = 34;      // node_id del nodo que enriqueciÃ³
    int64 enrichment_timestamp = 35;  // Timestamp del enriquecimiento

    // ğŸ”§ PIDS DE COMPONENTES DISTRIBUIDOS - TRACKING DEL PIPELINE
    int32 promiscuous_pid = 36;       // PID del promiscuous_agent que capturÃ³
    int32 geoip_enricher_pid = 37;    // PID del geoip_enricher que enriqueciÃ³
    int32 ml_detector_pid = 38;       // PID del ml_detector que analizÃ³
    int32 dashboard_pid = 39;         // PID del dashboard que visualizÃ³
    int32 firewall_pid = 40;          // PID del firewall que aplicÃ³ reglas

    // ğŸ“Š TIMESTAMPS DE PROCESAMIENTO POR COMPONENTE
    int64 promiscuous_timestamp = 41;     // Cuando fue capturado
    int64 geoip_enricher_timestamp = 42;  // Cuando fue enriquecido con GeoIP
    int64 ml_detector_timestamp = 43;     // Cuando fue analizado por ML
    int64 dashboard_timestamp = 44;       // Cuando fue mostrado en dashboard
    int64 firewall_timestamp = 45;        // Cuando fue procesado por firewall

    // ğŸ¯ MÃ‰TRICAS DE PIPELINE DISTRIBUIDO
    float processing_latency_ms = 46;     // Latencia total de procesamiento
    int32 pipeline_hops = 47;             // NÃºmero de saltos en el pipeline
    string pipeline_path = 48;            // Ruta del evento: "promiscuous->geoip->ml->dashboard"

    // ğŸ”„ CONTROL DE FLUJO DISTRIBUIDO
    int32 retry_count = 49;               // NÃºmero de reintentos en el pipeline
    string last_error = 50;               // Ãšltimo error encontrado
    bool requires_reprocessing = 51;      // Indica si necesita reprocesamiento

    // ğŸ·ï¸ TAGS Y METADATOS DISTRIBUIDOS
    repeated string component_tags = 52;  // Tags aÃ±adidos por cada componente
    map<string, string> component_metadata = 53; // Metadata adicional por componente
}