{
  "component": {
    "name": "geoip_enricher",
    "version": "3.1.0",
    "mode": "distributed_vertical",
    "description": "GeoIP Enricher v3.1.0 TRIPARTITO CLEAN - REAL LOOKUP tripartite (sniffer_node_geo + source_ip_geo + destination_ip_geo) + protobuf v3.1 support + sniffer geo calculated ONCE - connects to evolutionary_sniffer_v31 port 5570 - NO HARDCODED COORDINATES"
  },
  "node_id": "geoip_enricher_v31_001",
  "version": "3.1.0",
  "component_type": "geoip_enricher",

  "_comment_network": "üîå Red optimizada - CR√çTICO: CONNECT a evolutionary_sniffer_v31 (5570), BIND para ML (5560)",
  "network": {
    "input_socket": {
      "address": "localhost",
      "port": 5570,
      "mode": "connect",
      "socket_type": "PULL",
      "description": "Recibe eventos protobuf v3.1.0 CON NETWORK FEATURES del evolutionary_sniffer_v31"
    },
    "output_socket": {
      "address": "localhost",
      "port": 5560,
      "mode": "bind",
      "socket_type": "PUSH",
      "description": "Env√≠a eventos enriquecidos v3.1.0 CON GEO_ENRICHMENT TRIPARTITO al lightweight_ml_detector (puerto 5560)"
    }
  },

  "zmq": {
    "input_port": 5570,
    "output_port": 5560,
    "rcvhwm": 2000,
    "sndhwm": 2000,
    "recv_timeout_ms": 1000,
    "send_timeout_ms": 100,
    "linger_ms": 1000,
    "vertical_scaling_optimizations": {
      "io_threads": 1,
      "max_sockets": 128,
      "tcp_keepalive": true,
      "tcp_keepalive_idle": 300,
      "immediate": true
    }
  },

  "backpressure": {
    "enabled": true,
    "max_retries": 4,
    "retry_delays_ms": [1, 2, 4, 8],
    "drop_threshold_percent": 10.0,
    "activation_threshold": 75,
    "queue_full_strategy": "intelligent_drop",
    "vertical_optimizations": {
      "adaptive_delays": true,
      "cpu_aware_backpressure": true,
      "memory_pressure_detection": true
    }
  },

  "_comment_processing": "‚öôÔ∏è CR√çTICO: Configuraci√≥n de procesamiento v3.1.0 TRIPARTITO",
  "processing": {
    "threads": 3,
    "send_threads": 1,
    "internal_queue_size": 1000,
    "protobuf_queue_size": 500,
    "queue_timeout_seconds": 1.0,
    "performance_mode": "conservative_i9",

    "_comment_tripartite": "üéØ v3.1.0: Configurar enriquecimiento TRIPARTITO",
    "geolocate_sniffer_node": true,
    "geolocate_source_ip": true,
    "geolocate_destination_ip": true,
    "prioritize_source_ip": true,
    "handle_private_ips": true,
    "resolve_public_ip_for_private": true,
    "cache_sniffer_geo_permanently": true,
    "max_events_per_batch": 100,
    "batch_timeout_ms": 50,
    "worker_threads": 4,

    "_comment_tripartite_logic": "üè† NUEVO: L√≥gica espec√≠fica tripartito v3.1.0",
    "tripartite_enrichment": {
      "enabled": true,
      "calculate_sniffer_geo_once": true,
      "use_sniffer_geo_for_internal_destinations": true,
      "prioritize_external_source_lookup": true,
      "require_minimum_enriched": 2,
      "log_tripartite_success": true
    },

    "vertical_scaling": {
      "optimized_for_i9_8cores": true,
      "memory_pool_size_mb": 256,
      "cpu_affinity_enabled": false,
      "prefetch_geoip_data": false,
      "leave_cores_for_system": 4
    },
    "batch_processing": {
      "enabled": false,
      "batch_size": 25,
      "max_wait_ms": 50,
      "adaptive_batching": false
    },
    "queue_overflow_handling": {
      "max_queue_wait_ms": 100,
      "log_drops": true
    }
  },

  "_comment_geoip": "üåç MANTENIDO v3.1.0: Lookup REAL con MaxMind + IPAPI fallback - SIN HARDCODEOS",
  "geoip": {
    "lookup_method": "maxmind",
    "fallback_method": "ipapi",
    "performance_mode": "speed",
    "cache_enabled": true,
    "cache_size": 10000,
    "cache_ttl_seconds": 1800,
    "timeout_seconds": 5,

    "_comment_performance_modes": "‚ö° speed=cache agresivo, precision=cache m√≠nimo",
    "performance_profiles": {
      "speed": {
        "cache_ttl_seconds": 3600,
        "max_lookup_timeout": 2.0,
        "aggressive_caching": true,
        "skip_secondary_lookups": true
      },
      "precision": {
        "cache_ttl_seconds": 300,
        "max_lookup_timeout": 10.0,
        "aggressive_caching": false,
        "always_try_fallback": true
      }
    },

    "_comment_no_hardcodes": "üö® ELIMINADOS: coordenadas hardcoded, defaults autom√°ticos",
    "handle_lookup_failures": {
      "strategy": "empty_coordinates",
      "log_failures": true,
      "log_level": "WARNING",
      "retry_failed_ips": false,
      "never_use_fallback_coordinates": true
    },

    "vertical_optimizations": {
      "preload_common_ips": false,
      "memory_mapped_database": false,
      "batch_lookup_enabled": false,
      "lookup_timeout_ms": 20,
      "optimized_for_32gb_ram": true
    },

    "_comment_maxmind": "üåç MaxMind HABILITADO como m√©todo primario",
    "maxmind": {
      "enabled": true,
      "database_path": "geodata/GeoLite2-City.mmdb",
      "auto_update": false,
      "fallback_to_country": true,
      "connection_pool_size": 8,
      "fallback_database": "geodata/GeoLite2-Country.mmdb",
      "timeout_seconds": 2.0
    },

    "_comment_ipapi": "üåê IPAPI como fallback - API KEY desde variable de entorno IPAPI_TOKEN",
    "api": {
      "enabled": true,
      "provider": "ipapi",
      "base_url": "https://ipapi.co",
      "endpoint_format": "{ip}/json",
      "access_key_param": "key",
      "timeout_seconds": 5.0,
      "api_key": "$ENV:IPAPI_TOKEN",
      "rate_limit_per_minute": 1000,
      "retry_failed_requests": true,
      "max_retries": 2,
      "connection_pool_size": 10,
      "use_https": true,
      "_comment": "üîë IMPORTANTE: API key se lee autom√°ticamente de la variable de entorno IPAPI_TOKEN"
    },

    "precision": {
      "coordinate_precision": 6,
      "validate_coordinates": true,
      "min_latitude": -90.0,
      "max_latitude": 90.0,
      "min_longitude": -180.0,
      "max_longitude": 180.0
    }
  },

  "_comment_ip_handling": "üåê v3.1.0: Manejo avanzado de IPs con discovery p√∫blico - MANTENIDO",
  "ip_handling": {
    "private_ip_ranges": [
      "10.0.0.0/8",
      "172.16.0.0/12",
      "192.168.0.0/16",
      "127.0.0.0/8"
    ],
    "public_ip_discovery": {
      "enabled": true,
      "services": [
        "https://api.ipify.org",
        "https://ifconfig.me/ip",
        "https://icanhazip.com"
      ],
      "cache_duration": 3600,
      "timeout": 10,
      "_comment": "üîÑ Cache de 1 hora para IP p√∫blica - CR√çTICO para sniffer_node_geo"
    },
    "public_ip_resolution": {
      "for_private_source_ips": "discover_and_lookup",
      "for_private_destination_ips": "discover_and_lookup",
      "for_sniffer_node": "discover_once_and_cache_permanently",
      "cache_public_ip": true,
      "cache_duration": 3600
    }
  },

  "_comment_enrichment": "üîç v3.1.0: Configuraci√≥n de enriquecimiento TRIPARTITO",
  "enrichment": {
    "add_city_info": true,
    "add_country_info": true,
    "add_region_info": true,
    "add_timezone": true,
    "add_isp_info": true,
    "add_threat_intel": true,
    "calculate_distance": true,
    "_comment_tripartite": "üéØ v3.1.0: Enriquecimiento espec√≠fico tripartito",
    "tripartite_mode": {
      "enrich_sniffer_node_geo": true,
      "enrich_source_ip_geo": true,
      "enrich_destination_ip_geo": true,
      "populate_geo_analysis": true,
      "calculate_distances": true,
      "analyze_geographic_relationships": true
    },
    "field_behavior": {
      "network_features": "readonly_only",
      "geo_enrichment": "writeonly_only",
      "no_legacy_compatibility": true
    }
  },

  "_comment_filtering": "üîç v3.1.0: Filtros de eventos - MANTENIDO",
  "filtering": {
    "skip_localhost": false,
    "skip_private_networks": false,
    "min_risk_score": 0.0,
    "required_fields": ["source_ip", "destination_ip"],
    "blacklist_ips": [],
    "whitelist_ips": []
  },

  "_comment_output": "üì§ v3.1.0: Configuraci√≥n de salida TRIPARTITO",
  "output": {
    "include_original_event": true,
    "add_processing_metadata": true,
    "coordinate_precision": 6,
    "timestamp_format": "unix",
    "compress_output": false,
    "preserve_network_features": true,
    "only_enrich_geo_enrichment": true,
    "_comment_v31": "üì¶ v3.1.0: Solo escribir campos geo_enrichment"
  },

  "_comment_logging": "üìù LOGGING optimizado para v3.1.0 TRIPARTITO",
  "logging": {
    "level": "INFO",
    "format": "%(asctime)s | %(name)s | %(levelname)-8s | %(message)s",
    "_comment_format": "Formato de una l√≠nea compacto y legible",
    "handlers": {
      "console": {
        "enabled": true,
        "level": "INFO",
        "_comment": "Consola para monitoreo en tiempo real"
      },
      "file": {
        "enabled": true,
        "path": "logs/geoip_enricher_v31_tripartite.log",
        "level": "DEBUG",
        "max_size": "25MB",
        "backup_count": 3,
        "rotation": "time",
        "_comment": "Archivo espec√≠fico para versi√≥n v3.1.0 TRIPARTITO"
      }
    },
    "performance_logging": {
      "enabled": true,
      "log_slow_requests": true,
      "slow_request_threshold_ms": 50,
      "log_throughput_stats": true,
      "log_tripartite_stats": true
    }
  },

  "_comment_monitoring": "üìä v3.1.0: Monitoreo con nuevas m√©tricas TRIPARTITO",
  "monitoring": {
    "stats_interval_seconds": 15,
    "detailed_metrics": true,
    "health_check_interval": 30,
    "metrics_collection": true,
    "performance_tracking": true,
    "error_threshold": 10,
    "alert_on_database_errors": true,

    "vertical_scaling_metrics": {
      "track_cpu_per_core": true,
      "track_memory_pressure": true,
      "track_cache_efficiency": true,
      "track_batch_performance": true,
      "hardware_profile": "i9_8cores_32gb"
    },

    "_comment_tripartite_metrics": "üéØ NUEVO: M√©tricas espec√≠ficas para TRIPARTITO v3.1.0",
    "tripartite_metrics": {
      "track_sniffer_node_geo": true,
      "track_source_ip_geo": true,
      "track_destination_ip_geo": true,
      "track_tripartite_success_rate": true,
      "track_sniffer_geo_cache_hits": true,
      "track_private_ip_resolutions": true,
      "tripartite_success_threshold": 80.0
    },

    "component_health_check": {
      "enabled": true,
      "check_interval_seconds": 30,
      "memory_threshold_mb": 1024,
      "cpu_threshold_percent": 75.0,
      "cache_hit_rate_threshold": 70.0,
      "tripartite_success_rate_threshold": 75.0
    },

    "alerts": {
      "max_queue_usage_percent": 80.0,
      "max_geoip_failure_rate_percent": 25.0,
      "max_processing_latency_ms": 100.0,
      "max_backpressure_activations": 150,
      "min_cache_hit_rate_percent": 60.0,
      "max_memory_usage_mb": 1024,
      "max_cpu_sustained_percent": 70.0,
      "_comment_new_alerts": "üö® NUEVAS alertas para TRIPARTITO v3.1.0",
      "min_tripartite_success_rate_percent": 70.0,
      "max_sniffer_geo_calculation_failures": 3,
      "max_private_ip_resolution_failures": 20,
      "alert_on_protobuf_v31_errors": true
    },

    "metrics_export": {
      "enabled": false,
      "prometheus_port": 9090,
      "export_interval_seconds": 60,
      "include_tripartite_metrics": true
    }
  },

  "_comment_performance": "‚ö° v3.1.0: Configuraci√≥n de rendimiento optimizada para TRIPARTITO",
  "performance": {
    "enable_async_processing": true,
    "connection_pool_size": 10,
    "request_timeout": 5,
    "retry_attempts": 2,
    "backoff_factor": 1.5,
    "tripartite_optimization": {
      "cache_sniffer_geo_permanently": true,
      "optimize_private_ip_resolution": true,
      "batch_geographic_analysis": false
    }
  },

  "_comment_distributed": "üåê v3.1.0: Configuraci√≥n distribuida upgraded-happiness",
  "distributed": {
    "cluster_name": "upgraded-happiness-cluster",
    "component_role": "enricher_vertical_tripartite_v31",
    "enable_container_detection": true,
    "enable_system_info_collection": true,
    "pipeline_tracking": {
      "enabled": true,
      "track_latency": true,
      "track_component_path": true,
      "max_pipeline_hops": 10,
      "track_vertical_metrics": true,
      "track_tripartite_enrichment": true
    },
    "load_balancing": {
      "strategy": "vertical_single_node",
      "health_check_enabled": true,
      "failover_timeout_ms": 5000
    },
    "scaling": {
      "auto_scale_enabled": false,
      "scaling_type": "vertical",
      "min_instances": 1,
      "max_instances": 1,
      "scale_up_cpu_threshold": 75.0,
      "scale_up_memory_threshold": 70.0,
      "hardware_constraints": {
        "max_cores_available": 8,
        "max_memory_gb": 32,
        "recommended_threads": 6
      }
    }
  },

  "_comment_security": "üîí v3.1.0: Seguridad y validaci√≥n",
  "security": {
    "input_validation": {
      "enabled": true,
      "max_event_size_bytes": 1048576,
      "validate_protobuf_schema": true,
      "sanitize_ip_addresses": true,
      "enforce_network_features_readonly": true,
      "enforce_geo_enrichment_writeonly": true
    },
    "rate_limiting": {
      "enabled": true,
      "max_events_per_second": 2000,
      "max_requests_per_second": 1000,
      "burst_capacity": 4000,
      "penalty_duration_seconds": 60
    },
    "validate_ip_format": true,
    "input_sanitization": true
  },

  "_comment_debugging": "üêõ v3.1.0: Configuraci√≥n de debugging para TRIPARTITO",
  "debugging": {
    "enabled": true,
    "log_coordinates": true,
    "log_processing_time": true,
    "log_cache_hits": true,
    "detailed_error_logging": true,
    "log_lookup_methods": true,
    "log_ip_discovery": true,
    "_comment_new_debug": "üîç NUEVO: Debug espec√≠fico para TRIPARTITO v3.1.0",
    "log_tripartite_enrichment": true,
    "log_sniffer_geo_calculation": true,
    "log_private_ip_resolution": true,
    "trace_geographic_analysis": false
  },

  "_comment_integration": "üîó v3.1.0: Integraci√≥n con dashboard",
  "integration": {
    "dashboard_reporting": true,
    "metrics_export": true,
    "status_updates": true,
    "heartbeat_interval": 30,
    "report_tripartite_stats": true
  },

  "_comment_v31_features": "üÜï Nuevas caracter√≠sticas v3.1.0 TRIPARTITO CLEAN",
  "v31_features": {
    "tripartite_geoip_enrichment": true,
    "sniffer_node_geo_once": true,
    "source_ip_geo_priority": true,
    "destination_ip_geo_internal": true,
    "protobuf_v31_clean_support": true,
    "no_backward_compatibility": true,
    "enhanced_logging": true,
    "public_ip_discovery": true,
    "geographic_analysis": true,
    "real_geoip_lookup": true,
    "maxmind_integration": true,
    "ipapi_integration": true,
    "no_hardcoded_coordinates": true,
    "performance_configurable": true,
    "_comment_new_features": "üîç NUEVAS caracter√≠sticas TRIPARTITO v3.1.0",
    "network_features_readonly": true,
    "geo_enrichment_writeonly": true,
    "sniffer_geo_permanent_cache": true,
    "private_ip_smart_resolution": true,
    "geographic_relationship_analysis": true
  },

  "_comment_requirements": "üì¶ Dependencias requeridas para v3.1.0 TRIPARTITO",
  "requirements": {
    "python_packages": [
      "geoip2>=4.0",
      "maxminddb>=2.0"
    ],
    "external_data": [
      "GeoLite2-City.mmdb",
      "GeoLite2-Country.mmdb"
    ],
    "api_services": [
      "ipapi.co token (variable de entorno IPAPI_TOKEN)"
    ],
    "protobuf_schema": [
      "network_security_clean_v31_pb2.py"
    ],
    "setup_instructions": {
      "1": "pip install geoip2",
      "2": "Descargar GeoLite2-City.mmdb de MaxMind",
      "3": "Colocar en geodata/GeoLite2-City.mmdb",
      "4": "export IPAPI_TOKEN='tu_token_real_aqui' (variable de entorno)",
      "5": "Verificar que evolutionary_sniffer_v31 env√≠a protobuf v3.1 con network_features en puerto 5570",
      "6": "Configurar fallback_method como 'ipapi'",
      "7": "Compilar protobuf v3.1: network_security_clean_v31_pb2.py"
    }
  },

  "debug": {
    "enabled": false,
    "sample_events": false,
    "sample_rate_percent": 1.0,
    "log_protobuf_details": false,
    "profile_performance": false,
    "log_vertical_metrics": false,
    "log_lookup_details": true,
    "_comment_tripartite_debug": "üîç Debug espec√≠fico TRIPARTITO v3.1.0",
    "trace_sniffer_geo_calculation": false,
    "trace_private_ip_resolution": false,
    "log_geographic_analysis": true,
    "validate_tripartite_completeness": true
  }
}